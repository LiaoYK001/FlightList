<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="è·¯å¾„/favicon.ico">
    <meta charset="UTF-8">
    <title>ğŸŒèˆªç©ºå®¢è¿è®¢ç¥¨ç³»ç»ŸğŸŒ</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .container {
            display: flex;
            justify-content: space-between;
        }
        .form-container {
            flex: 1;
            padding: 10px;
        }
        .table-container {
            flex: 1;
            padding: 10px;
        }
        .form-section {
            margin-bottom: 20px;
        }
        .result {
            margin-top: 10px;
        }
    </style>
</head>
<body onload="loadDefaultData()">
    <div class="container">
        <div class="form-container">
            <h1>âœˆèˆªç©ºå®¢è¿è®¢ç¥¨ç³»ç»Ÿâœˆ</h1>
            <label style="color: rgba(197, 95, 95, 0.745);"><b>æ•°æ®ç»“æ„ç»¼åˆä½œä¸šæ‹“å±•é¡¹ç›®-Htmlé™æ€ç½‘ç«™ï¼ˆby LYKï¼ŒBZï¼ŒHYZï¼‰</b></label>
            <div class="form-section">
                <h2>ä»æ–‡ä»¶ä¸­è¯»å–èˆªç­ä¿¡æ¯</h2>
                <input type="file" id="fileInput">
                <button onclick="loadFlightsFromFile()">åŠ è½½èˆªç­ä¿¡æ¯</button>
            </div>

            <div class="form-section">
                <h2>ğŸ”¥æŸ¥è¯¢èˆªçº¿</h2>
                <label>
                    ç»ˆç‚¹ç«™ï¼š<input type="text" id="queryDestination">
                </label>
                <button onclick="queryFlight()">æŸ¥è¯¢èˆªçº¿</button>
                <div id="queryResult" class="result"></div>
            </div>

            <div class="form-section">
                <h2 style="color: rgb(255, 59, 255);">ğŸ’¥è®¢ç¥¨ä¸šåŠ¡</h2>
                <label style="color: red;"><b>æ³¨æ„ï¼Œå€™è¡¥éµå¾ªå…ˆæ¥ååˆ°ï¼ˆé˜Ÿåˆ—æ¨¡å¼ï¼‰</b></label>
                <label>
                    èˆªç­å·ï¼š<input type="text" id="bookFlightNumber">
                </label>
                <label>
                    è®¢ç¥¨æ•°é¢ï¼š<input type="number" id="bookTickets">
                </label>
                <button onclick="bookTickets()">æ‰¿åŠè®¢ç¥¨</button>
                <div id="bookingResult" class="result"></div>
            </div>

            <div class="form-section">
                <h2 style="color: rgb(255, 59, 255);">ğŸ’¥é€€ç¥¨ä¸šåŠ¡</h2>
                <label>
                    èˆªç­å·ï¼š<input type="text" id="cancelFlightNumber">
                </label>
                <label>
                    é€€ç¥¨æ—¥æœŸï¼š<input type="date" id="cancelDate">
                </label>
                <button onclick="cancelTickets()">æ‰¿åŠé€€ç¥¨</button>
                <div id="cancelResult" class="result"></div>
            </div>

            <div class="form-section">
                <h2 style="color: rgb(116, 116, 116);">æ‰‹å·¥å½•å…¥èˆªç­ä¿¡æ¯</h2>
                <label>
                    ç»ˆç‚¹ç«™ï¼š<input type="text" id="manualDestination">
                </label>
                <label>
                    èˆªç­å·ï¼š<input type="text" id="manualFlightNumber">
                </label>
                <label>
                    æœºå‹ï¼š<input type="text" id="manualPlaneNumber">
                </label>
                <label>
                    æ˜ŸæœŸå‡ ï¼š<input type="text" id="manualFlightDays">
                </label>
                <label>
                    æœ€å¤§äººå‘˜ï¼š<input type="number" id="manualCapacity">
                </label>
                <label>
                    ä½™ç¥¨é‡ï¼š<input type="number" id="manualRemainingTickets">
                </label>
                <button onclick="addManualFlight()">æ·»åŠ èˆªç­</button>
                <div id="manualInputResult" class="result"></div>
            </div>
        </div>

        <div class="table-container">
            <div id="flightsTableContainer" class="result"></div>
        </div>
    </div>

    <script>
        class Customer {
            constructor(name, tickets) {
                this.name = name;
                this.tickets = tickets;
            }
        }

        class WaitingCustomer {
            constructor(name, tickets) {
                this.name = name;
                this.tickets = tickets;
            }
        }

        class ListNode {
            constructor(customer, next = null) {
                this.customer = customer;
                this.next = next;
            }
        }

        class LinkedList {
            constructor() {
                this.head = null;
            }

            find(name) {
                let current = this.head;
                while (current !== null) {
                    if (current.customer.name === name) {
                        return current.customer;
                    }
                    current = current.next;
                }
                return null;
            }

            insert(customer) {
                if (this.head === null || this.head.customer.name > customer.name) {
                    this.head = new ListNode(customer, this.head);
                } else {
                    let current = this.head;
                    while (current.next !== null && current.next.customer.name < customer.name) {
                        current = current.next;
                    }
                    current.next = new ListNode(customer, current.next);
                }
            }

            delete(name) {
                if (this.head === null) {
                    return null;
                }
                if (this.head.customer.name === name) {
                    const customer = this.head.customer;
                    this.head = this.head.next;
                    return customer;
                }
                let current = this.head;
                while (current.next !== null && current.next.customer.name !== name) {
                    current = current.next;
                }
                if (current.next === null) {
                    return null;
                }
                const customer = current.next.customer;
                current.next = current.next.next;
                return customer;
            }
        }

        class QueueNode {
            constructor(customer, next = null) {
                this.customer = customer;
                this.next = next;
            }
        }

        class Queue {
            constructor() {
                this.front = null;
                this.rear = null;
            }

            enqueue(customer) {
                const node = new QueueNode(customer);
                if (this.rear === null) {
                    this.front = this.rear = node;
                } else {
                    this.rear.next = node;
                    this.rear = node;
                }
            }

            dequeue() {
                if (this.front === null) {
                    return null;
                }
                const customer = this.front.customer;
                this.front = this.front.next;
                if (this.front === null) {
                    this.rear = null;
                }
                return customer;
            }

            isEmpty() {
                return this.front === null;
            }
        }

        class Flight {
            constructor(destination, flightNumber, planeNumber, flightDays, capacity, remainingTickets) {
                this.destination = destination;
                this.flightNumber = flightNumber;
                this.planeNumber = planeNumber;
                this.flightDays = flightDays;
                this.capacity = capacity;
                this.remainingTickets = remainingTickets;
                this.bookedCustomers = new LinkedList();
                this.waitingCustomers = new Queue();
            }
        }

        let flights = [];
        
        function loadDefaultData() {
            const data = `
èˆªçº¿:å¹¿å·
èˆªç­å·:CZ456
æœºå‹:A320
æ˜ŸæœŸå‡ :2 4 6
æœ€å¤§äººå‘˜:120
ä½™ç¥¨é‡:80
å·²è®¢ç¥¨å®¢æˆ·:2
å§“å:Alen
è®¢ç¥¨é‡:1
å§“å:Jack
è®¢ç¥¨é‡:3
å€™è¡¥:1
å§“å:Yu
æ‰€éœ€ç¥¨é‡:1

èˆªçº¿:åŒ—äº¬
èˆªç­å·:G673
æœºå‹:A350
æ˜ŸæœŸå‡ :4 6
æœ€å¤§äººå‘˜:200
ä½™ç¥¨é‡:140
å·²è®¢ç¥¨å®¢æˆ·:1
å§“å:Alen
è®¢ç¥¨é‡:1
å€™è¡¥:1
å§“å:Yu
æ‰€éœ€ç¥¨é‡:4

èˆªçº¿:ğŸš€ç«æ˜ŸğŸš€
èˆªç­å·:é©¬æ–¯å…‹ç‰¹æ´¾
æœºå‹:Falcon9
æ˜ŸæœŸå‡ :2 3 4 6
æœ€å¤§äººå‘˜:99
ä½™ç¥¨é‡:8
å·²è®¢ç¥¨å®¢æˆ·:2
å§“å:è€ç‹
è®¢ç¥¨é‡:1
å§“å:è€ç™»
è®¢ç¥¨é‡:1
å€™è¡¥:0

èˆªçº¿:åŒ—äº¬
èˆªç­å·:G600
æœºå‹:A350
æ˜ŸæœŸå‡ :1 4 6 7
æœ€å¤§äººå‘˜:200
ä½™ç¥¨é‡:100
å·²è®¢ç¥¨å®¢æˆ·:3
å§“å:Alen
è®¢ç¥¨é‡:1
å§“å:Lao
è®¢ç¥¨é‡:1
å§“å:Tim
è®¢ç¥¨é‡:3
å€™è¡¥:1
å§“å:Yuo
æ‰€éœ€ç¥¨é‡:4

èˆªçº¿:æˆéƒ½
èˆªç­å·:MU3423
æœºå‹:787
æ˜ŸæœŸå‡ :2 3 4 6
æœ€å¤§äººå‘˜:140
ä½™ç¥¨é‡:100
å·²è®¢ç¥¨å®¢æˆ·:0
å€™è¡¥:0

            `;
            parseFlightData(data);
            displayFlightsTable();
        }

        function loadFlightsFromFile() {    //ä»æ–‡ä»¶å½•å…¥ï¼
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const content = event.target.result;
                parseFlightData(content);
                displayFlightsTable();
                alert('èˆªç­ä¿¡æ¯å·²åŠ è½½');
            };
            
            reader.readAsText(file);
        }

        function parseFlightData(data) {  //è¯»å–çš„å‡½æ•°
            const lines = data.split('\n');
            let flight = null;
            let currentSection = '';

            lines.forEach(line => {
                const [key, value] = line.split(':').map(s => s.trim());
                switch(key) {
                    case 'èˆªçº¿':
                        const [destination] = value.split('-');
                        flight = new Flight(destination, '', '', '', 0, 0);
                        flights.push(flight);
                        break;
                    case 'èˆªç­å·':
                        flight.flightNumber = value;
                        break;
                    case 'æœºå‹':
                        flight.planeNumber = value;
                        break;
                    case 'æ˜ŸæœŸå‡ ':
                        flight.flightDays = value;
                        break;
                    case 'æœ€å¤§äººå‘˜':
                        flight.capacity = parseInt(value);
                        break;
                    case 'ä½™ç¥¨é‡':
                        flight.remainingTickets = parseInt(value);
                        break;
                    case 'å·²è®¢ç¥¨å®¢æˆ·':
                        currentSection = 'booked';
                        flight.bookedCustomers = new LinkedList();
                        break;
                    case 'å€™è¡¥':
                        currentSection = 'waiting';
                        flight.waitingCustomers = new Queue();
                        break;
                    case 'å§“å':
                        if (currentSection === 'booked') {
                            let currentCustomer = new Customer(value, 0);
                            flight.bookedCustomers.insert(currentCustomer);
                        } else if (currentSection === 'waiting') {
                            let currentCustomer = new WaitingCustomer(value, 0);
                            flight.waitingCustomers.enqueue(currentCustomer);
                        }
                        break;
                    case 'è®¢ç¥¨é‡':
                        let bookedCurrent = flight.bookedCustomers.head;
                        while (bookedCurrent !== null) {
                            if (bookedCurrent.customer.tickets === 0) {
                                bookedCurrent.customer.tickets = parseInt(value);
                                break;
                            }
                            bookedCurrent = bookedCurrent.next;
                        }
                        break;
                    case 'æ‰€éœ€ç¥¨é‡':
                        let waitingCurrent = flight.waitingCustomers.front;
                        while (waitingCurrent !== null) {
                            if (waitingCurrent.customer.tickets === 0) {
                                waitingCurrent.customer.tickets = parseInt(value);
                                break;
                            }
                            waitingCurrent = waitingCurrent.next;
                        }
                        break;
                    default:
                        // æœªæ‰§è¡Œï¼Œè·³ï¼
                        break;
                }
            });
        }

        function displayFlightsTable() {
    const container = document.getElementById('flightsTableContainer');
    let tableHTML = '<h3>èˆªç­ä¿¡æ¯</h3><table border="1"><tr><th>ç»ˆç‚¹</th><th>èˆªç­å·</th><th>æœºå‹</th><th>æ˜ŸæœŸ</th><th>æœ€å¤§äººå‘˜</th><th>ä½™ç¥¨é‡</th></tr>';
    
    flights.forEach(flight => {
        tableHTML += `<tr>
            <td style="color: red;"><b>${flight.destination}</td>
            <td style="color: orange;"><b>${flight.flightNumber}</td>
            <td style="color: blue;"><b>${flight.planeNumber}</td>
            <td>${flight.flightDays}</td>
            <td>${flight.capacity}</td>
            <td>${flight.remainingTickets}</td>
        </tr>`;
        tableHTML += '<tr><td colspan="6"><strong>å·²è®¢ç¥¨å®¢æˆ·:</strong><ul>';
        let current = flight.bookedCustomers.head;
        while (current) {
            tableHTML += `<li>${current.customer.name} (${current.customer.tickets}å¼ )</li>`;
            current = current.next;
        }
        tableHTML += '</ul></td></tr>';
        tableHTML += '<tr><td colspan="6"><strong>å€™è¡¥å®¢æˆ·:</strong><ul>';
        current = flight.waitingCustomers.front;
        while (current) {
            tableHTML += `<li>${current.customer.name} (${current.customer.tickets}å¼ )</li>`;
            current = current.next;
        }
        tableHTML += '</ul></td></tr>';
    });
    
    tableHTML += '</table>';
    container.innerHTML = tableHTML;
}


        function queryFlight() {
            const destination = document.getElementById('queryDestination').value;
            let result = flights.filter(flight => flight.destination === destination);

            let output = '<h3>æŸ¥è¯¢ç»“æœ</h3>';
            if (result.length === 0) {
                output += '<p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èˆªçº¿</p>';
            } else {
                result.forEach(flight => {
                    output += `<p>èˆªç­å·: ${flight.flightNumber}, æœºå‹: ${flight.planeNumber}, æ˜ŸæœŸ: ${flight.flightDays}, ä½™ç¥¨é‡: ${flight.remainingTickets}</p>`;
                });
            }
            document.getElementById('queryResult').innerHTML = output;
        }

        function bookTickets() {
             const flightNumber = document.getElementById('bookFlightNumber').value;
             const bookTickets = parseInt(document.getElementById('bookTickets').value);
             const customerName = prompt('è¯·è¾“å…¥å®¢æˆ·å§“å');

             let flight = flights.find(flight => flight.flightNumber === flightNumber);

             let output = '<h3>è®¢ç¥¨ç»“æœ</h3>';
             if (!flight) {
                output += '<p>æ²¡æœ‰æ‰¾åˆ°è¯¥èˆªç­</p>';
            } else if (flight.remainingTickets >= bookTickets) {
                flight.remainingTickets -= bookTickets;
                flight.bookedCustomers.insert(new Customer(customerName, bookTickets));
                output += `<p>æˆåŠŸè®¢ç¥¨${bookTickets}å¼ , ä½™ç¥¨é‡: ${flight.remainingTickets}</p>`;
                displayFlightsTable(); // æ›´æ–°
            } else {
                flight.waitingCustomers.enqueue(new WaitingCustomer(customerName, bookTickets));
                output += '<p>ä½™ç¥¨ä¸è¶³ï¼Œå®¢æˆ·å·²åŠ å…¥å€™è¡¥åå•</p>';
                displayFlightsTable(); // æ›´æ–°
            }
            document.getElementById('bookingResult').innerHTML = output;
}

        
        function cancelTickets() {
            const flightNumber = document.getElementById('cancelFlightNumber').value;
            const customerName = prompt('è¯·è¾“å…¥å®¢æˆ·å§“å');

            let flight = flights.find(flight => flight.flightNumber === flightNumber);

            let output = '<h3>é€€ç¥¨ç»“æœ</h3>';
            if (!flight) {
                output += '<p>æ²¡æœ‰æ‰¾åˆ°è¯¥èˆªç­</p>';
            }
                else{
                const customer = flight.bookedCustomers.delete(customerName);
                if (customer) {
                    flight.remainingTickets += customer.tickets;
                    output += `<p>æˆåŠŸé€€ç¥¨${customer.tickets}å¼ , ä½™ç¥¨é‡: ${flight.remainingTickets}</p>`;
                    while (!flight.waitingCustomers.isEmpty() && flight.remainingTickets >= flight.waitingCustomers.front.customer.tickets) {
                        const waitingCustomer = flight.waitingCustomers.dequeue();
                        flight.remainingTickets -= waitingCustomer.tickets;
                        flight.bookedCustomers.insert(new Customer(waitingCustomer.name, waitingCustomer.tickets));
                        output += `<p>${waitingCustomer.name} å·²ä»å€™è¡¥åå•ä¸­è®¢ç¥¨${waitingCustomer.tickets}å¼ , ä½™ç¥¨é‡: ${flight.remainingTickets}</p>`;
                    }
                    displayFlightsTable(); // æ›´æ–°è¡¨æ ¼
                } else {
                    output += '<p>æ²¡æœ‰æ‰¾åˆ°è¯¥å®¢æˆ·çš„è®¢ç¥¨è®°å½•</p>';
                }
            }
            document.getElementById('cancelResult').innerHTML = output;
        }


  function addManualFlight() {
    const destination = document.getElementById('manualDestination').value;
    const flightNumber = document.getElementById('manualFlightNumber').value;
    const planeNumber = document.getElementById('manualPlaneNumber').value;
    const flightDays = document.getElementById('manualFlightDays').value;
    const capacity = parseInt(document.getElementById('manualCapacity').value);
    const remainingTickets = parseInt(document.getElementById('manualRemainingTickets').value);

    if(capacity<remainingTickets){
        document.getElementById('manualInputResult').innerHTML = '<p>ä½ ä¼šé‡å­å‹ç¼©å—ï¼Ÿæ€ä¹ˆä½™ç¥¨å¤§äºäº†æœ€å¤§é‡</p>';
        return;
    }
    if (!destination || !flightNumber || !planeNumber || !flightDays || isNaN(capacity) || isNaN(remainingTickets)) {
        document.getElementById('manualInputResult').innerHTML = '<p>æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¿…å¡«çš„ï¼Œå¹¶ä¸”æœ€å¤§äººå‘˜å’Œä½™ç¥¨é‡åº”ä¸ºæ•°å­—</p>';
        return;
    }

    const newFlight = new Flight(destination, flightNumber, planeNumber, flightDays, capacity, remainingTickets);
    flights.push(newFlight);

    displayFlightsTable(); // æ›´æ–°èˆªç­ä¿¡æ¯è¡¨æ ¼

    document.getElementById('manualInputResult').innerHTML = '<p>èˆªç­ä¿¡æ¯å·²æˆåŠŸæ·»åŠ </p>';
        }
    </script>
</body>
</html>
